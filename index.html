<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Catalogue - Bande-annonces (TMDb)</title>
  <meta name="description" content="Catalogue de films avec bandes-annonces — intégré TMDb" />
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#06b6d4;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;background:linear-gradient(180deg,#071026 0%,#071724 60%);color:#e6eef6}
    header{display:flex;align-items:center;justify-content:space-between;padding:18px 26px;background:linear-gradient(90deg,rgba(6,182,212,0.06),transparent);backdrop-filter:blur(4px)}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:48px;height:48px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent),#7c3aed);font-weight:700}
    h1{font-size:18px;margin:0}
    .search{display:flex;gap:8px;align-items:center}
    .search input{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit;min-width:220px}
    main{padding:20px;max-width:1200px;margin:18px auto}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:18px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:12px;overflow:hidden;box-shadow:0 6px 20px rgba(2,6,23,0.6);transition:transform .18s ease}
    .card:hover{transform:translateY(-6px)}
    .poster{width:100%;height:300px;object-fit:cover;background:#0a1624}
    .card-body{padding:12px}
    .title{font-weight:700;margin:0 0 6px 0;font-size:16px}
    .meta{font-size:13px;color:var(--muted)}
    .btn{display:inline-flex;gap:8px;align-items:center;padding:8px 12px;border-radius:10px;border:none;background:var(--accent);color:#04233a;cursor:pointer}
    footer{padding:24px;text-align:center;color:var(--muted);font-size:13px}
    /* modal */
    .modal{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:none;align-items:center;justify-content:center;padding:20px;z-index:50}
    .modal.open{display:flex}
    .modal-card{width:100%;max-width:980px;background:#071322;border-radius:12px;overflow:hidden}
    .modal-top{display:flex;align-items:center;gap:12px;padding:12px}
    .modal-content{padding:16px}
    .copy-btn{margin-top:12px}
    /* ads */
    .ads-vertical{position:fixed;right:12px;top:96px;width:360px}
    @media(max-width:1000px){.ads-vertical{display:none}}
    .hero{display:flex;gap:18px;align-items:center;padding:18px;border-radius:12px;margin-bottom:18px;background:linear-gradient(90deg,rgba(255,255,255,0.02),transparent)}
    .hero .info{flex:1}
    .skeleton{height:12px;background:linear-gradient(90deg,#0e1722,#0b2540);border-radius:8px}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">TM</div>
      <div>
        <h1>Catalogue — Bandes-annonces</h1>
        <div style="color:var(--muted);font-size:13px">Design moderne • Intégration des publicités</div>
      </div>
    </div>
    <div class="search">
      <input id="q" placeholder="Rechercher un film, ex: Inception" />
      <button id="searchBtn" class="btn">Rechercher</button>
    </div>
  </header>

  <main>
    <section class="hero">
      <div style="width:160px;height:90px;background:#082233;border-radius:10px;display:flex;align-items:center;justify-content:center;color:var(--muted);font-weight:700">Affiche</div>
      <div class="info">
        <h2 style="margin:0 0 6px 0">Découvrez les bandes-annonces</h2>
        <div style="color:var(--muted);font-size:14px">Parcourez le catalogue, ouvrez la fiche d'un film et regardez la bande-annonce — puis copiez le lien YouTube.</div>
      </div>
      <!-- Pub verticale intégrée -->
      <div style="min-width:160px;display:flex;align-items:center;justify-content:center">
        <!-- vertical ad placeholder -->
        <div style="width:120px;height:90px;background:linear-gradient(180deg,#06202b,#083045);border-radius:8px;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:12px">Espace pub</div>
      </div>
    </section>

    <!-- responsive grid de films -->
    <div id="movies" class="grid"></div>

    <div style="display:flex;gap:10px;align-items:center;justify-content:center;margin-top:18px">
      <button id="prev" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)">Précédent</button>
      <div id="page" style="color:var(--muted)">Page 1</div>
      <button id="next" class="btn">Suivant</button>
    </div>

  </main>

  <!-- modal bande-annonce -->
  <div id="modal" class="modal" role="dialog" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-top">
        <div style="width:84px;height:56px;background:#061827;border-radius:6px;overflow:hidden" id="modalPoster"></div>
        <div style="flex:1">
          <div id="modalTitle" style="font-weight:700"></div>
          <div id="modalOverview" style="color:var(--muted);font-size:14px;margin-top:6px"></div>
        </div>
        <div style="padding:12px"><button id="closeModal" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)">Fermer</button></div>
      </div>
      <div class="modal-content">
        <div id="videoWrapper" style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:8px;background:#000">
          <!-- iframe inséré dynamiquement -->
        </div>
        <div style="display:flex;gap:12px;align-items:center;margin-top:12px">
          <button id="copyUrl" class="btn copy-btn">Copier l'URL de la bande-annonce</button>
          <a id="openOnYoutube" class="btn" target="_blank" rel="noopener">Ouvrir sur YouTube</a>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div>© Catalogue TMDb — Design professionnel • Intégration publicitaire</div>
    <div style="margin-top:6px;color:var(--muted);font-size:12px">Note: Remplacez la clé d'API si nécessaire. Les images proviennent de image.tmdb.org</div>
  </footer>

  <!-- Publicités (insérez sur chaque page comme demandé) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3659884670016121" crossorigin="anonymous"></script>
  <!-- Vertical 5719446138 Multiplex -->
  <ins class="adsbygoogle" style="display:inline-block;width:360px;height:800px" data-ad-client="ca-pub-3659884670016121" data-ad-slot="5719446138"></ins>
  <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>

  <!-- Display 5988111272 -->
  <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3659884670016121" data-ad-slot="5988111272" data-ad-format="auto" data-full-width-responsive="true"></ins>
  <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>

  <script>
    // --- CONFIGURATION ---
    const TMDB_BEARER = "eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJmMGZiMzE0MWEyOWQ1MTY1NGU5Y2ZkOWM5MGYxNjI2NyIsIm5iZiI6MTcyMTQ4MTMzNS45NjMsInN1YiI6IjY2OWJiODc3MTc0OTgzOWJmODhlYWM2OCIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.WU6WYxkzGVxHJJQpUJ2xt3lyyB9hCXBbesUN3WTN-V0";
    const IMAGE_BASE = 'https://image.tmdb.org/t/p/w500';

    // pagination
    let page = 1;
    let query = '';

    const moviesEl = document.getElementById('movies');
    const pageEl = document.getElementById('page');
    const nextBtn = document.getElementById('next');
    const prevBtn = document.getElementById('prev');
    const qInput = document.getElementById('q');
    const searchBtn = document.getElementById('searchBtn');

    async function fetchMovies(){
      moviesEl.innerHTML = '';
      showLoadingSkeleton();
      const endpoint = query.trim() ?
        `https://api.themoviedb.org/3/search/movie?query=${encodeURIComponent(query)}&page=${page}` :
        `https://api.themoviedb.org/3/movie/popular?page=${page}`;

      const res = await fetch(endpoint, {headers:{Authorization: 'Bearer ' + TMDB_BEARER}});
      if(!res.ok){
        moviesEl.innerHTML = '<div style="color:var(--muted);padding:20px">Erreur lors de la récupération des films.</div>';
        return;
      }
      const data = await res.json();
      pageEl.textContent = `Page ${page} — résultats: ${data.total_results ?? '?'} `;
      renderMovies(data.results||[]);
    }

    function showLoadingSkeleton(){
      for(let i=0;i<8;i++){
        const s = document.createElement('div'); s.className='card'; s.innerHTML=`<div style="height:240px;background:#071728"></div><div class="card-body"><div class="skeleton" style="width:70%"></div><div style="height:8px"></div><div class="skeleton" style="width:40%"></div></div>`;
        moviesEl.appendChild(s);
      }
    }

    function renderMovies(list){
      moviesEl.innerHTML = '';
      if(list.length===0){moviesEl.innerHTML='<div style="color:var(--muted);padding:20px">Aucun film trouvé.</div>';return}
      list.forEach(m=>{
        const el = document.createElement('article'); el.className='card';
        const poster = m.poster_path? (IMAGE_BASE+m.poster_path) : '';
        el.innerHTML = `
          <img loading="lazy" class="poster" src="${poster}" alt="${escapeHtml(m.title)}">
          <div class="card-body">
            <div class="title">${escapeHtml(m.title)}</div>
            <div class="meta">${m.release_date||'—'} • Note: ${m.vote_average||'—'}</div>
            <div style="height:10px"></div>
            <div style="display:flex;gap:8px;align-items:center">
              <button class="btn see" data-id="${m.id}">Voir la fiche</button>
              <button class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)" data-id="${m.id}" onclick="openTrailer(${m.id})">Voir la bande-annonce</button>
            </div>
          </div>
        `;
        moviesEl.appendChild(el);
      });

      // attach event for fiche
      document.querySelectorAll('.see').forEach(btn=>btn.addEventListener('click',async e=>{
        const id = e.currentTarget.dataset.id; await openDetails(id);
      }));
    }

    async function openDetails(id){
      // fetch details
      const res = await fetch(`https://api.themoviedb.org/3/movie/${id}`,{headers:{Authorization:'Bearer '+TMDB_BEARER}});
      if(!res.ok) return alert('Impossible de charger la fiche');
      const data = await res.json();
      // open modal with details + trailer
      showModal(data);
    }

    async function openTrailer(id){
      // open the same modal but ensure trailer
      const res = await fetch(`https://api.themoviedb.org/3/movie/${id}/videos`,{headers:{Authorization:'Bearer '+TMDB_BEARER}});
      if(!res.ok) return alert('Impossible de récupérer la vidéo');
      const d = await res.json();
      const youtube = (d.results||[]).find(v=>v.site==='YouTube' && v.type==='Trailer') || (d.results||[]).find(v=>v.site==='YouTube');
      if(!youtube) return alert('Aucune bande-annonce YouTube disponible');
      const movieRes = await fetch(`https://api.themoviedb.org/3/movie/${id}`,{headers:{Authorization:'Bearer '+TMDB_BEARER}});
      const movie = await movieRes.json();
      showModal(movie, youtube);
    }

    // modal logic
    const modal = document.getElementById('modal');
    const closeModal = document.getElementById('closeModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalOverview = document.getElementById('modalOverview');
    const modalPoster = document.getElementById('modalPoster');
    const videoWrapper = document.getElementById('videoWrapper');
    const copyBtn = document.getElementById('copyUrl');
    const openOnYoutube = document.getElementById('openOnYoutube');

    function showModal(movie, trailer){
      modalTitle.textContent = movie.title;
      modalOverview.textContent = movie.overview || '';
      modalPoster.innerHTML = movie.poster_path ? `<img src="${IMAGE_BASE+movie.poster_path}" style="width:100%;height:100%;object-fit:cover">` : '';

      videoWrapper.innerHTML = '';
      if(trailer){
        const ytUrl = `https://www.youtube.com/watch?v=${trailer.key}`;
        const iframe = document.createElement('iframe');
        iframe.width = '100%'; iframe.height = '100%';
        iframe.src = `https://www.youtube.com/embed/${trailer.key}?autoplay=1&rel=0`;
        iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
        iframe.style.position='absolute'; iframe.style.left='0'; iframe.style.top='0'; iframe.style.width='100%'; iframe.style.height='100%'; iframe.setAttribute('frameborder','0');
        videoWrapper.appendChild(iframe);
        copyBtn.onclick = ()=>{navigator.clipboard.writeText(ytUrl).then(()=>alert('URL copiée dans le presse-papiers'))};
        openOnYoutube.href = ytUrl; openOnYoutube.style.display='inline-flex';
      } else {
        videoWrapper.innerHTML = '<div style="padding:40px;color:var(--muted)">Aucune bande-annonce disponible pour ce film.</div>';
        copyBtn.onclick = ()=>alert('Aucune URL à copier');
        openOnYoutube.style.display='none';
      }

      modal.classList.add('open'); modal.setAttribute('aria-hidden','false');
    }

    closeModal.addEventListener('click',()=>{modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); videoWrapper.innerHTML='';});
    modal.addEventListener('click',e=>{if(e.target===modal){modal.classList.remove('open');modal.setAttribute('aria-hidden','true');videoWrapper.innerHTML='';}});

    // Search + pagination
    searchBtn.addEventListener('click',()=>{query = qInput.value; page=1; fetchMovies();});
    qInput.addEventListener('keypress',e=>{if(e.key==='Enter'){query=qInput.value;page=1;fetchMovies();}});
    nextBtn.addEventListener('click',()=>{page++;fetchMovies();});
    prevBtn.addEventListener('click',()=>{if(page>1){page--;fetchMovies();}});

    // initial load
    fetchMovies();

    // helpers
    function escapeHtml(str){ if(!str) return ''; return String(str).replace(/[&<>\"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','\\':'\\\\','"':'&quot;'}[c])); }

  </script>
</body>
</html>
